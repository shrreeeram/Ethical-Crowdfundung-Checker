<!DOCTYPE html>
<html lang="en" x-data="adminPanel()" x-init="init()" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - Ethical Crowdfunding</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans">

  <div class="max-w-7xl mx-auto px-4 py-6">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-4xl font-bold text-red-600 dark:text-red-400">Admin Panel</h1>
      <button @click="toggleTheme" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600">Toggle Theme</button>
    </div>

    <!-- Table -->
    <form action="/bulk-approve" method="POST">
      <div class="overflow-x-auto rounded-lg shadow">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-800 text-sm text-left">
          <thead class="bg-gray-100 dark:bg-gray-700 sticky top-0">
            <tr>
              <th class="p-3">✔</th>
              <th class="p-3">Title</th>
              <th class="p-3">Company</th>
              <th class="p-3">Description</th>
              <th class="p-3">Amount</th>
              <th class="p-3">Address</th>
              <th class="p-3">Status</th>
              <th class="p-3">Reason</th>
              <th class="p-3">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100 dark:divide-gray-600">
            {% for c in campaigns %}
            <tr>
              <td class="p-3">
                {% if c.status == 'Pending' %}
                <input type="checkbox" name="selected[]" value="{{ loop.index0 }}">
                {% endif %}
              </td>
              <td class="p-3">{{ c.title }}</td>
              <td class="p-3">{{ c.company }}</td>
              <td class="p-3">{{ c.description }}</td>
              <td class="p-3">{{ c.amount }}</td>
              <td class="p-3">{{ c.address }}</td>
              <td class="p-3">{{ c.status }}</td>
              <td class="p-3">{{ c.reason }}</td>
              <td class="p-3">
                {% if c.status == 'Pending' %}
                <div class="space-y-2">
                  <form action="/approve/{{ loop.index0 }}" method="POST" class="flex gap-1">
                    <input type="text" name="reason" placeholder="Approve reason" required class="flex-1 px-2 py-1 rounded border dark:bg-gray-800 dark:border-gray-600" />
                    <button type="submit" class="bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700">✔</button>
                  </form>
                  <form action="/reject/{{ loop.index0 }}" method="POST" class="flex gap-1">
                    <input type="text" name="reason" placeholder="Reject reason" required class="flex-1 px-2 py-1 rounded border dark:bg-gray-800 dark:border-gray-600" />
                    <button type="submit" class="bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700">✖</button>
                  </form>
                </div>
                {% else %}
                <span class="text-xs text-gray-500">Processed</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Bulk Approve -->
      <div class="mt-4 flex flex-col sm:flex-row gap-3 items-start sm:items-center bg-gray-100 dark:bg-gray-800 p-4 rounded shadow">
        <textarea name="reason" required placeholder="Reason for approving selected..." class="w-full sm:w-auto flex-1 p-2 border rounded dark:bg-gray-700 dark:border-gray-600"></textarea>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50" :disabled="!hasSelections()">✅ Bulk Approve</button>
      </div>
    </form>

    <!-- ✅ Toast -->
    {% if message %}
    <div x-data="{ show: true }" x-show="show" x-init="setTimeout(() => show = false, 3000)" class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow">
      {{ message }}
    </div>
    {% endif %}
  </div>

  <script>
    function adminPanel() {
      return {
        toggleTheme() {
          const html = document.documentElement;
          const isDark = html.classList.toggle('dark');
          localStorage.theme = isDark ? 'dark' : 'light';
        },
        hasSelections() {
          return document.querySelectorAll('input[name="selected[]"]:checked').length > 0;
        }
      };
    }
  </script>
</body>
</html>